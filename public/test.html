<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API - Spotify API</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="background-animation">
        <div class="music-wave wave1"></div>
        <div class="music-wave wave2"></div>
        <div class="music-wave wave3"></div>
        <div class="music-wave wave4"></div>
    </div>
    
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="logo-icon">üéµ</span>
                <span class="logo-text">SpotifyAPI</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">Home</a>
                <a href="/explore" class="nav-link">Explore</a>
                <a href="/test" class="nav-link active">Test API</a>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="hero-title">
                    <span class="gradient-text">Test</span> Our API
                </h1>
                <p class="hero-description">
                    Try out the API with different Spotify URLs and see the responses in real-time.
                    Perfect for testing and development.
                </p>
            </div>
        </div>

        <div class="test-section">
            <div class="container">
                <div class="test-interface">
                    <div class="test-input-section">
                        <h3>API Testing Interface</h3>
                        
                        <div class="input-group">
                            <label for="apiEndpoint">Endpoint</label>
                            <input type="text" id="apiEndpoint" value="/api/spotify" readonly class="readonly-input">
                        </div>

                        <div class="input-group">
                            <label for="testUrl">Spotify URL</label>
                            <input type="text" id="testUrl" placeholder="Enter Spotify track URL..." class="test-input">
                        </div>

                        <div class="input-group">
                            <label>Quick Test URLs</label>
                            <div class="quick-urls">
                                <button onclick="setTestUrl('https://open.spotify.com/track/4iV5W9uYEdYUVa79Axb7Rh')" class="quick-btn">
                                    Popular Song
                                </button>
                                <button onclick="setTestUrl('https://open.spotify.com/track/7qiZfU4dY1lWllzX7mPBI3')" class="quick-btn">
                                    Rock Classic
                                </button>
                                <button onclick="setTestUrl('https://open.spotify.com/track/0VjIjW4GlUZAMYd2vXMi3b')" class="quick-btn">
                                    Electronic
                                </button>
                            </div>
                        </div>

                        <div class="test-controls">
                            <button onclick="testAPI()" class="test-btn primary" id="testBtn">
                                <span>üß™</span> Test API
                            </button>
                            <button onclick="clearResults()" class="test-btn secondary">
                                <span>üóë</span> Clear
                            </button>
                        </div>
                    </div>

                    <div class="test-results-section">
                        <div class="results-header">
                            <h3>API Response</h3>
                            <div class="status-indicator" id="statusIndicator">
                                <span class="status-dot"></span>
                                <span class="status-text">Ready</span>
                            </div>
                        </div>

                        <div class="response-container">
                            <div class="loading-state" id="loadingState">
                                <div class="spinner"></div>
                                <span>Testing API...</span>
                            </div>

                            <div class="response-tabs">
                                <button class="tab-btn active" onclick="switchTab('response')">Response</button>
                                <button class="tab-btn" onclick="switchTab('headers')">Headers</button>
                                <button class="tab-btn" onclick="switchTab('curl')">cURL</button>
                            </div>

                            <div class="tab-content" id="responseTab">
                                <pre><code id="responseData">Click "Test API" to see the response</code></pre>
                            </div>

                            <div class="tab-content hidden" id="headersTab">
                                <pre><code id="responseHeaders">No response headers yet</code></pre>
                            </div>

                            <div class="tab-content hidden" id="curlTab">
                                <pre><code id="curlCommand">curl -X GET "your-endpoint-url"</code></pre>
                            </div>
                        </div>

                        <div class="response-info" id="responseInfo">
                            <div class="info-item">
                                <span class="info-label">Status:</span>
                                <span class="info-value" id="responseStatus">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Time:</span>
                                <span class="info-value" id="responseTime">-</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Size:</span>
                                <span class="info-value" id="responseSize">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="test-examples">
                    <h3>Test Scenarios</h3>
                    <div class="scenarios-grid">
                        <div class="scenario-card">
                            <h4>‚úÖ Valid Request</h4>
                            <p>Test with a valid Spotify track URL</p>
                            <div class="scenario-example">
                                <code>https://open.spotify.com/track/4iV5W9uYEdYUVa79Axb7Rh</code>
                            </div>
                        </div>

                        <div class="scenario-card">
                            <h4>‚ùå Invalid URL</h4>
                            <p>Test error handling with invalid URL</p>
                            <div class="scenario-example">
                                <code>https://invalid-url.com</code>
                            </div>
                        </div>

                        <div class="scenario-card">
                            <h4>‚ùå Missing Parameter</h4>
                            <p>Test without URL parameter</p>
                            <div class="scenario-example">
                                <code>(empty URL)</code>
                            </div>
                        </div>

                        <div class="scenario-card">
                            <h4>‚ùå Wrong Spotify URL</h4>
                            <p>Test with playlist instead of track</p>
                            <div class="scenario-example">
                                <code>https://open.spotify.com/playlist/example</code>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="health-check">
                    <h3>API Health Check</h3>
                    <button onclick="checkHealth()" class="health-btn">
                        <span>üè•</span> Check API Health
                    </button>
                    <div class="health-status" id="healthStatus">
                        Click to check API health
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let currentTab = 'response';

        function setTestUrl(url) {
            document.getElementById('testUrl').value = url;
            updateCurlCommand();
        }

        function updateCurlCommand() {
            const url = document.getElementById('testUrl').value;
            const baseUrl = window.location.origin;
            const curlCmd = `curl -X GET "${baseUrl}/api/spotify?url=${encodeURIComponent(url)}"`;
            document.getElementById('curlCommand').textContent = curlCmd;
        }

        function switchTab(tabName) {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));

            // Add active class to current tab
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            currentTab = tabName;
        }

        async function testAPI() {
            const url = document.getElementById('testUrl').value.trim();
            const loadingState = document.getElementById('loadingState');
            const statusIndicator = document.getElementById('statusIndicator');
            const testBtn = document.getElementById('testBtn');

            // Reset UI
            loadingState.style.display = 'flex';
            testBtn.disabled = true;
            setStatus('testing', 'Testing...');

            const startTime = Date.now();

            try {
                const response = await fetch(`/api/spotify?url=${encodeURIComponent(url)}`);
                const data = await response.json();
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                // Update response data
                document.getElementById('responseData').textContent = JSON.stringify(data, null, 2);
                
                // Update response headers
                const headers = {};
                for (let [key, value] of response.headers.entries()) {
                    headers[key] = value;
                }
                document.getElementById('responseHeaders').textContent = JSON.stringify(headers, null, 2);

                // Update response info
                document.getElementById('responseStatus').textContent = response.status;
                document.getElementById('responseTime').textContent = responseTime + 'ms';
                document.getElementById('responseSize').textContent = new Blob([JSON.stringify(data)]).size + ' bytes';

                // Set status based on response
                if (response.ok && data.success) {
                    setStatus('success', 'Success');
                } else {
                    setStatus('error', 'Error');
                }

            } catch (error) {
                const endTime = Date.now();
                const responseTime = endTime - startTime;

                document.getElementById('responseData').textContent = JSON.stringify({
                    success: false,
                    error: error.message,
                    timestamp: new Date().toISOString()
                }, null, 2);

                document.getElementById('responseStatus').textContent = 'Network Error';
                document.getElementById('responseTime').textContent = responseTime + 'ms';
                document.getElementById('responseSize').textContent = '-';

                setStatus('error', 'Network Error');
            } finally {
                loadingState.style.display = 'none';
                testBtn.disabled = false;
                updateCurlCommand();
            }
        }

        async function checkHealth() {
            const healthStatus = document.getElementById('healthStatus');
            
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                
                if (data.success) {
                    healthStatus.innerHTML = '<span style="color: #10b981;">‚úÖ API is healthy and running</span>';
                } else {
                    healthStatus.innerHTML = '<span style="color: #ef4444;">‚ùå API health check failed</span>';
                }
            } catch (error) {
                healthStatus.innerHTML = '<span style="color: #ef4444;">‚ùå Cannot connect to API</span>';
            }
        }

        function setStatus(type, text) {
            const indicator = document.getElementById('statusIndicator');
            const dot = indicator.querySelector('.status-dot');
            const textEl = indicator.querySelector('.status-text');
            
            dot.className = `status-dot ${type}`;
            textEl.textContent = text;
        }

        function clearResults() {
            document.getElementById('responseData').textContent = 'Click "Test API" to see the response';
            document.getElementById('responseHeaders').textContent = 'No response headers yet';
            document.getElementById('responseStatus').textContent = '-';
            document.getElementById('responseTime').textContent = '-';
            document.getElementById('responseSize').textContent = '-';
            setStatus('ready', 'Ready');
        }

        // Initialize curl command
        document.getElementById('testUrl').addEventListener('input', updateCurlCommand);
        updateCurlCommand();
    </script>
</body>
</html>
